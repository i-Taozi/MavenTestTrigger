language: java
jdk: [openjdk8]
cache:
  bundler: true
  directories: [/home/travis/.m2]
sudo: false
services: [mysql]
before_install: [export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64, mysql -e 'CREATE
    DATABASE IF NOT EXISTS cat;', mysql -u root --password="" cat < script/CatApplication.sql,
  mkdir -p $HOME/data/appdatas/cat && mkdir -p $HOME/data/applogs, cp ./docker/datasources.xml
    $HOME/data/appdatas/cat && export MYSQL_URL="127.0.0.1" && export MYSQL_PORT="3306"
    && export MYSQL_USERNAME="root"  && export MYSQL_PASSWD="" &&  export MYSQL_SCHEMA="cat"
    && sed "s# /data/# $HOME/data/#g" ./docker/datasources.sh > $HOME/data/datasources.sh
    && sh $HOME/data/datasources.sh, cp ./docker/client.xml $HOME/data/appdatas/cat/,
  bash -c " ls -l ~/.m2 &&  du -sm  ~/.m2/ "]
install: export CAT_HOME=$HOME/data/appdatas/cat && mvn install -DskipTests -Dorg.slf4j.simpleLogger.defaultLogLevel=warn
script: bash -c " export CAT_HOME=$HOME/data/appdatas/cat && mvn test -Dorg.slf4j.simpleLogger.defaultLogLevel=warn"
branches:
  only: [dianping/cat-2137-origin]
